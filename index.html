import logging
import asyncio
import re
from datetime import datetime
from aiogram import Bot, Dispatcher, types, F
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton, ReplyKeyboardRemove, InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext
from aiogram.filters import Command
from aiogram.fsm.storage.memory import MemoryStorage
import urllib

helptext = "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–ª–∏ –≤ –æ–±—â–∏–π –¥–æ—Å—Ç—É–ø, –ø—Ä–æ–∏–∑–æ—à–ª–æ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ! –ü–æ–º–æ–≥–∏—Ç–µ –º–Ω–µ!"
encoded_helptext = urllib.parse.quote(helptext)

# ===== –£–∫–∞–∂–∏ —Å–≤–æ–π —Ç–æ–∫–µ–Ω –∏ –∏–º—è –±–æ—Ç–∞ =====
API_TOKEN = "–¢–û–ö–ï–ù"
FORWARD_TO_CHAT_ID = 8321802362   # –ö—É–¥–∞ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –§–ò–û
DATA_FILE = "reg.txt"
BOT_NAME = "–ú–¢–°"  # –ò–º—è –±–æ—Ç–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–º–µ—Å—Ç–µ —Å —é–∑–µ—Ä–Ω–µ–π–º–æ–º

logging.basicConfig(level=logging.INFO)

bot = Bot(token=API_TOKEN)
dp = Dispatcher(storage=MemoryStorage())

async def send_message(message: types.Message, text: str, kb=None, parse_mode=None):
    sent = await message.answer(text, reply_markup=kb, parse_mode=parse_mode)
    return sent

# ===== –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –¥–∞–Ω–Ω—ã—Ö =====
async def save_and_forward_partial(message: types.Message, state: FSMContext, is_complete=False):
    data = await state.get_data()
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    user_id = message.from_user.id
    username = message.from_user.username or ''
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º —é–∑–µ—Ä–Ω–µ–π–º –∏ –∏–º—è –±–æ—Ç–∞
    user_with_bot = f"@{username} ({BOT_NAME})" if username else f"({BOT_NAME})"
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è —Ñ–∞–π–ª–∞
    doc_type = data.get('document_type', '')
    doc_num = data.get('document_number', '')
    
    record = (
        f"{timestamp}\t{user_id}\t{user_with_bot}\t"
        f"{data.get('fullname', '')}\t{data.get('phone', '')}\t"
        f"{doc_type} {doc_num}\n"
    )
    
    # –í—Å–µ–≥–¥–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ reg.txt, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—á–Ω—ã–µ
    try:
        with open(DATA_FILE, "a", encoding="utf-8") as f:
            f.write(record)
        logging.info(f"–ó–∞–ø–∏—Å–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –≤ {DATA_FILE}: {record.strip()}")
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª: {e}")
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –≤ Telegram
    status = "–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" if is_complete else "–ß–∞—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"
    forward_text = (
        f"{status} –¥–ª—è {user_with_bot} ({user_id}):\n"
    )
    if 'fullname' in data:
        forward_text += f"–§–ò–û: {data['fullname']}\n"
    if 'phone' in data:
        forward_text += f"–¢–µ–ª–µ—Ñ–æ–Ω: {data['phone']}\n"
    if doc_type and doc_num:
        forward_text += f"–î–æ–∫—É–º–µ–Ω—Ç: {doc_type} {doc_num}\n"
    
    # –ü–µ—Ä–µ—Å—ã–ª–∞–µ–º –≤ Telegram-—á–∞—Ç
    try:
        await bot.send_message(FORWARD_TO_CHAT_ID, forward_text)
        logging.info(f"–ü–µ—Ä–µ—Å–ª–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ —á–∞—Ç {FORWARD_TO_CHAT_ID}: {forward_text.strip()}")
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å—ã–ª–∫–µ –≤ Telegram: {e}")

class Form(StatesGroup):
    fullname = State()
    phone = State()
    document_type = State()
    document_number = State()

main_menu = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="üìù –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")],
        [KeyboardButton(text="üîÑ –ü–æ–º–µ–Ω—è—Ç—å —Ç–∞—Ä–∏—Ñ")],
        [KeyboardButton(text="üí≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å")],
        [KeyboardButton(text="üí∏ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å")],
        [KeyboardButton(text="üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏")]
    ],
    resize_keyboard=True
)

additional_services_menu = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã")],
        [KeyboardButton(text="‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è")],
        [KeyboardButton(text="üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π")],
        [KeyboardButton(text="‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥")]
    ],
    resize_keyboard=True
)

back_button = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥")]
    ],
    resize_keyboard=True
)

unauthorized_action_menu = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="üîê –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")],
        [KeyboardButton(text="‚Ü©Ô∏è –°–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ")]
    ],
    resize_keyboard=True
)

@dp.message(Command("start"))
async def cmd_start(message: types.Message, state: FSMContext):
    await state.clear()
    await send_message(message, "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", main_menu)

@dp.message(F.text == "üìù –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")
async def start_form(message: types.Message, state: FSMContext):
    await state.set_state(Form.fullname)
    await send_message(message, "<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>", parse_mode="HTML")
    await send_message(message, "üë§ –£–∫–∞–∂–∏—Ç–µ –§–∞–º–∏–ª–∏—é –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç):", back_button)

@dp.message(Form.fullname)
async def get_fullname(message: types.Message, state: FSMContext):
    if message.text == "‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":
        await state.clear()
        await send_message(message, "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", main_menu)
        return
    if not re.match(r'^[–ê-–Ø–∞-—è–Å—ë\s-]+$', message.text):
        await send_message(message, "‚ùå –§–ò–û –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.", back_button)
        return
    clean_text = re.sub(r'\s+', ' ', message.text.strip())
    await state.update_data(fullname=clean_text)
    
    await save_and_forward_partial(message, state)

    await state.set_state(Form.phone)
    await send_message(message, "<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>", parse_mode="HTML")
    await send_message(message, "üìû –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–Ω–∞—á–Ω–∏—Ç–µ —Å +7 –∏–ª–∏ 7, –Ω–∞–ø—Ä–∏–º–µ—Ä: +79991234567):", back_button)

@dp.message(Form.phone)
async def get_phone(message: types.Message, state: FSMContext):
    if message.text == "‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":
        await state.set_state(Form.fullname)
        await send_message(message, "<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>", parse_mode="HTML")
        await send_message(message, "üë§ –£–∫–∞–∂–∏—Ç–µ –§–∞–º–∏–ª–∏—é –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç):", back_button)
        return
    phone = message.text.strip()
    
    digits = re.sub(r'[^0-9]', '', phone)
    if not (phone.startswith('+7') or phone.startswith('7')):
        await send_message(message, "‚ùå –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å +7 –∏–ª–∏ 7. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.", back_button)
        return
    if len(digits) < 10 or len(digits) > 11:
        await send_message(message, "‚ùå –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10 –∏–ª–∏ 11 —Ü–∏—Ñ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.", back_button)
        return
    
    await state.update_data(phone=phone)
    await save_and_forward_partial(message, state)

    kb = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="üìÑ –ü–∞—Å–ø–æ—Ä—Ç")],
            [KeyboardButton(text="üßæ –ò–ù–ù")],
            [KeyboardButton(text="üü¢ –°–ù–ò–õ–°")],
            [KeyboardButton(text="‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥")]
        ],
        resize_keyboard=True
    )
    await state.set_state(Form.document_type)
    await send_message(message, "–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç:", kb)

@dp.message(Form.document_type)
async def get_document_type(message: types.Message, state: FSMContext):
    if message.text == "‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":
        await state.set_state(Form.phone)
        await send_message(message, "<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>", parse_mode="HTML")
        await send_message(message, "üìû –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–Ω–∞—á–Ω–∏—Ç–µ —Å +7 –∏–ª–∏ 7, –Ω–∞–ø—Ä–∏–º–µ—Ä: +79991234567):", back_button)
        return
    if message.text == "üìÑ –ü–∞—Å–ø–æ—Ä—Ç":
        await state.update_data(document_type="–ü–∞—Å–ø–æ—Ä—Ç")
        await state.set_state(Form.document_number)
        await send_message(message, "<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>", parse_mode="HTML")
        await send_message(message, "–í–≤–µ–¥–∏—Ç–µ —Å–µ—Ä–∏—é –∏ –Ω–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞ (–ø—Ä–∏–º–µ—Ä: 4510 123456):", back_button)
    elif message.text == "üßæ –ò–ù–ù":
        await state.update_data(document_type="–ò–ù–ù")
        await state.set_state(Form.document_number)
        await send_message(message, "<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>", parse_mode="HTML")
        await send_message(message, "–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù (–ø—Ä–∏–º–µ—Ä: 500100732259):", back_button)
    elif message.text == "üü¢ –°–ù–ò–õ–°":
        await state.update_data(document_type="–°–ù–ò–õ–°")
        await state.set_state(Form.document_number)
        await send_message(message, "<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>", parse_mode="HTML")
        await send_message(message, "–í–≤–µ–¥–∏—Ç–µ –°–ù–ò–õ–° (–ø—Ä–∏–º–µ—Ä: 112-233-445 95):", back_button)
    else:
        await send_message(message, "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç.", back_button)
        return
    
    await save_and_forward_partial(message, state)

@dp.message(Form.document_number)
async def get_document_number(message: types.Message, state: FSMContext):
    if message.text == "‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":
        kb = ReplyKeyboardMarkup(
            keyboard=[
                [KeyboardButton(text="üìÑ –ü–∞—Å–ø–æ—Ä—Ç")],
                [KeyboardButton(text="üßæ –ò–ù–ù")],
                [KeyboardButton(text="üü¢ –°–ù–ò–õ–°")],
                [KeyboardButton(text="‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥")]
            ],
            resize_keyboard=True
        )
        await state.set_state(Form.document_type)
        await send_message(message, "–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç:", kb)
        return
    await state.update_data(document_number=message.text)
    
    # –§–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ reg.txt
    await save_and_forward_partial(message, state, is_complete=True)

    # ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç
    inline_kb = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –Ω–µ —Ä–æ–±–æ—Ç", url="https://redirect.figma.site/")]
        ]
    )
    await message.answer("–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —á—Ç–æ –≤—ã –Ω–µ —Ä–æ–±–æ—Ç!", reply_markup=inline_kb)

    await state.clear()

@dp.message(F.text == "üîÑ –ü–æ–º–µ–Ω—è—Ç—å —Ç–∞—Ä–∏—Ñ")
async def change_tariff(message: types.Message):
    await send_message(message, "–ú—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–º–µ–Ω—è—Ç—å –∏–∑-–∑–∞ —Ç–æ–≥–æ —á—Ç–æ –≤—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª–∏—Å—å.", unauthorized_action_menu)

@dp.message(F.text == "üí≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å")
async def check_balance(message: types.Message):
    await send_message(message, "–ú—ã –Ω–µ –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑-–∑–∞ —Ç–æ–≥–æ —á—Ç–æ –≤—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª–∏—Å—å.", unauthorized_action_menu)

@dp.message(F.text == "üí∏ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å")
async def refill_balance(message: types.Message):
    await send_message(message, "–ú—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ø–æ–ª–Ω–∏—Ç—å –∏–∑-–∑–∞ —Ç–æ–≥–æ —á—Ç–æ –≤—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª–∏—Å—å.", unauthorized_action_menu)

@dp.message(F.text == "üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏")
async def additional_services_menu_handler(message: types.Message):
    await send_message(message, "üõ†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é:", additional_services_menu)

@dp.message(F.text == "‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã")
async def faq_menu(message: types.Message):
    kb = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏")],
            [KeyboardButton(text="üîí –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ?")],
            [KeyboardButton(text="‚ö°Ô∏è –ü–æ—á–µ–º—É —á–µ—Ä–µ–∑ Telegram?")],
            [KeyboardButton(text="üìë –ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?")],
            [KeyboardButton(text="üîÅ –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É?")],
            [KeyboardButton(text="‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥")]
        ],
        resize_keyboard=True
    )
    await send_message(message, "‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:", kb)

@dp.message(F.text == "üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏")
async def faq_penalty(message: types.Message):
    await send_message(message, "‚ö†Ô∏è –ï—Å–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω –≤–æ–≤—Ä–µ–º—è, –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.", back_button)

@dp.message(F.text == "üîí –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ?")
async def faq_safe(message: types.Message):
    await send_message(message, "üîê –î–∞, —É –Ω–∞—Å —Å—Ç–æ–∏—Ç –∑–∞—â–∏—Ç–∞ VISION 3.87676 PRO VS (—Å–∫–≤–æ–∑–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ).", back_button)

@dp.message(F.text == "‚ö°Ô∏è –ü–æ—á–µ–º—É —á–µ—Ä–µ–∑ Telegram?")
async def faq_telegram(message: types.Message):
    await send_message(message, "‚ö°Ô∏è –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∫–∏.", back_button)

@dp.message(F.text == "üîÅ –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É?")
async def faq_fix(message: types.Message):
    await send_message(message, "‚úÖ –î–∞, –º–æ–∂–Ω–æ. –°–≤—è–∂–∏—Ç–µ—Å—å —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥.", back_button)

@dp.message(F.text == "üìë –ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?")
async def faq_documents(message: types.Message):
    await send_message(message, "üëâ –ü–∞—Å–ø–æ—Ä—Ç, –ò–ù–ù, –°–ù–ò–õ–°.", back_button)

@dp.message(F.text == "‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è")
async def instruction(message: types.Message):
    text = (
        "üìã –ß—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:\n"
        "1Ô∏è‚É£ –ù–∞–∂–º–∏—Ç–µ ¬´–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ¬ª.\n"
        "2Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.\n"
        "3Ô∏è‚É£ –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –∏ –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ –Ω–æ–º–µ—Ä.\n"
        "4Ô∏è‚É£ –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ."
    )
    await send_message(message, text, back_button)

@dp.message(F.text == "üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π")
async def contact_support(message: types.Message):
    support_text = (
        "üìû –î–ª—è —Å–≤—è–∑–∏ —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –Ω–∏–∂–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –≤ —á–∞—Ç:\n"
        f"<a href='tg://resolve?domain=techsupgkh'>@techsupgkh</a>"
    )
    await send_message(message, support_text, parse_mode="HTML", kb=back_button)

@dp.message(F.text == "üîê –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
async def authorize(message: types.Message, state: FSMContext):
    await start_form(message, state)

@dp.message(F.text == "‚Ü©Ô∏è –°–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ")
async def change_action(message: types.Message):
    await send_message(message, "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", main_menu)

# ===== –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥ =====
@dp.message(F.text == "‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥")
async def back_to_menu(message: types.Message, state: FSMContext):
    await state.clear()
    await send_message(message, "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", main_menu)

# ===== –ó–∞–ø—É—Å–∫ =====
async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
