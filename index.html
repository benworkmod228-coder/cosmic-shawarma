<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Garant_Squad</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
margin:0;
font-family:Segoe UI, sans-serif;
background:linear-gradient(135deg,#0f0f0f,#1a1a1a);
color:white;
}

header{
padding:18px;
text-align:center;
font-size:22px;
font-weight:bold;
background:#111;
box-shadow:0 0 20px rgba(0,255,200,0.2);
}

.tabs{
display:flex;
background:#151515;
}

.tabs button{
flex:1;
padding:12px;
border:none;
background:none;
color:white;
font-weight:bold;
cursor:pointer;
transition:0.3s;
}

.tabs button.active{
border-bottom:3px solid #00ffc8;
}

.container{
padding:20px;
}

.card{
background:#1e1e1e;
padding:20px;
border-radius:15px;
margin-bottom:20px;
box-shadow:0 0 15px rgba(0,255,200,0.05);
animation:fadeIn 0.4s ease;
}

@keyframes fadeIn{
from{opacity:0;transform:translateY(10px);}
to{opacity:1;transform:translateY(0);}
}

input,textarea,select{
width:100%;
padding:12px;
margin-top:8px;
margin-bottom:15px;
border-radius:10px;
border:none;
background:#2a2a2a;
color:white;
}

button.primary{
width:100%;
padding:14px;
border-radius:12px;
border:none;
font-weight:bold;
cursor:pointer;
background:linear-gradient(90deg,#00ffc8,#00b3ff);
color:black;
transition:0.3s;
}

button.primary:hover{
transform:scale(1.03);
}

.deal{
background:#141414;
padding:15px;
border-radius:12px;
margin-top:10px;
}

.status{
font-size:12px;
padding:4px 8px;
border-radius:8px;
display:inline-block;
}

.pending{background:#444;}
.accepted{background:#0066ff;}
.completed{background:#00aa66;}
.rejected{background:#aa0000;}

.hidden{display:none;}

.rating{
color:#00ffc8;
font-size:18px;
}
</style>
</head>

<body>

<header>üõ° Garant_Squad</header>

<div class="tabs">
<button onclick="switchTab('create')" id="tab-create" class="active">–°–æ–∑–¥–∞—Ç—å</button>
<button onclick="switchTab('deals')" id="tab-deals">–°–¥–µ–ª–∫–∏</button>
<button onclick="switchTab('profile')" id="tab-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
</div>

<div class="container">

<div id="create" class="tab-content">

<div class="card">
<h3>–°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏</h3>

<select id="role">
<option value="buyer">–Ø –ø–æ–∫—É–ø–∞—Ç–µ–ª—å</option>
<option value="seller">–Ø –ø—Ä–æ–¥–∞–≤–µ—Ü</option>
</select>

<input type="number" id="secondUser" placeholder="ID –≤—Ç–æ—Ä–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞">

<input type="number" id="amount" placeholder="–°—É–º–º–∞ –æ—Ç 2$" min="2">

<textarea id="description" rows="5"
placeholder="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ —É—Å–ª–æ–≤–∏—è —Å–¥–µ–ª–∫–∏: —á—Ç–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è, —Å—Ä–æ–∫–∏, —Ñ–æ—Ä–º–∞—Ç, –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–æ—Ä–æ–Ω...">
</textarea>

<input type="file" id="fileUpload">

<button class="primary" onclick="createDeal()">–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</button>

</div>
</div>

<div id="deals" class="tab-content hidden">
<div class="card">
<h3>–ú–æ–∏ —Å–¥–µ–ª–∫–∏</h3>
<div id="dealsList"></div>
</div>
</div>

<div id="profile" class="tab-content hidden">
<div class="card">
<h3>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
<div>ID: <span id="myId"></span></div>
<div>–†–µ–π—Ç–∏–Ω–≥:</div>
<div class="rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
</div>
</div>

</div>

<script>

const API_URL = "https://nondefinite-retreative-cheree.ngrok-free.dev";
const tg = window.Telegram.WebApp;
tg.expand();

document.getElementById("myId").innerText = tg.initDataUnsafe.user.id;

function switchTab(tab){
document.querySelectorAll(".tab-content").forEach(t=>t.classList.add("hidden"));
document.getElementById(tab).classList.remove("hidden");

document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
document.getElementById("tab-"+tab).classList.add("active");
}

async function createDeal(){

const role=document.getElementById("role").value;
const secondUser=document.getElementById("secondUser").value;
const amount=parseFloat(document.getElementById("amount").value);
const description=document.getElementById("description").value;
const fileInput=document.getElementById("fileUpload");

if(!secondUser||amount<2||description.length<20){
alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–º–∏–Ω 2$ –∏ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)");
return;
}

const formData=new FormData();
formData.append("role",role);
formData.append("creator_id",tg.initDataUnsafe.user.id);
formData.append("second_user_id",secondUser);
formData.append("amount",amount);
formData.append("description",description);
formData.append("initData",tg.initData);

if(fileInput.files.length){
formData.append("file",fileInput.files[0]);
}

const response=await fetch(API_URL+"/create_deal",{method:"POST",body:formData});
const result=await response.json();

if(result.success){
alert("–°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!");
loadDeals();
}else{
alert("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏");
}
}

async function loadDeals(){
const response=await fetch(API_URL+"/my_deals?user_id="+tg.initDataUnsafe.user.id);
const deals=await response.json();
renderDeals(deals);
}

function renderDeals(deals){
const list=document.getElementById("dealsList");
list.innerHTML="";

if(deals.length===0){
list.innerHTML="<div class='deal'>–ù–µ—Ç —Å–¥–µ–ª–æ–∫</div>";
return;
}

deals.forEach(d=>{
list.innerHTML+=`
<div class="deal">
üíº ${d.amount}$<br>
üë§ ${d.second_user_id}<br>
üìÇ ${d.file_name||"–ù–µ—Ç —Ñ–∞–π–ª–∞"}<br>
<span class="status ${d.status}">${d.status}</span>
</div>
`;
});
}

loadDeals();

</script>

</body>
</html>
