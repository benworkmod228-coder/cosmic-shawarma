import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardButton, InlineKeyboardMarkup, WebAppInfo

# === –í–°–¢–ê–í–¨ —Å–≤–æ–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç BotFather ===
API_TOKEN = "–¢–û–ö–ï–ù_–¢–í–û–ï–ì–û_–ë–û–¢–ê"

bot = Bot(API_TOKEN)
dp = Dispatcher()

# ====== –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ======
users = {}

# ====== –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã ======
main_kb = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="üí∞ –ë–∞–ª–∞–Ω—Å"), KeyboardButton(text="üìä –¢–∞—Ä–∏—Ñ")],
        [KeyboardButton(text="‚ùì –í–æ–ø—Ä–æ—Å—ã"), KeyboardButton(text="‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è")],
        [KeyboardButton(text="üõ† –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞")],
        [KeyboardButton(text="üöÄ –û—Ç–∫—Ä—ã—Ç—å –ú–ö–°")]
    ],
    resize_keyboard=True
)

# ====== –°—Ç–∞—Ä—Ç ======
@dp.message(Command("start"))
async def start_cmd(message: types.Message):
    user_id = message.from_user.id
    if user_id not in users:
        users[user_id] = {"authorized": False, "fio": None, "phone": None, "doc": None}
    await message.answer("üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú–ö–°!\n–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –§–ò–û:")

# ====== –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π ======
@dp.message()
async def handle_message(message: types.Message):
    user_id = message.from_user.id
    text = message.text

    if user_id not in users:
        users[user_id] = {"authorized": False, "fio": None, "phone": None, "doc": None}

    user = users[user_id]

    # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ —à–∞–≥–∞–º
    if not user["authorized"]:
        if user["fio"] is None:
            user["fio"] = text
            await message.answer("üì± –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:")
            return
        if user["phone"] is None:
            user["phone"] = text
            await message.answer("üÜî –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞:")
            return
        if user["doc"] is None:
            user["doc"] = text
            user["authorized"] = True
            await message.answer("‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!", reply_markup=main_kb)
            return

    # –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –∫–æ–º–∞–Ω–¥—ã –º–µ–Ω—é
    if user["authorized"]:
        if text == "üí∞ –ë–∞–ª–∞–Ω—Å":
            await message.answer("–í–∞—à –±–∞–ª–∞–Ω—Å: 1 250 ‚ÇΩ")
        elif text == "üìä –¢–∞—Ä–∏—Ñ":
            await message.answer("–í–∞—à —Ç–∞—Ä–∏—Ñ: ¬´–ú–ö–° –ö–æ–º—Ñ–æ—Ä—Ç+¬ª ‚Äî 500 ‚ÇΩ/–º–µ—Å")
        elif text == "‚ùì –í–æ–ø—Ä–æ—Å—ã":
            await message.answer("‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:\n1. –ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å?\n2. –ö–∞–∫ —Å–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ?\n3. –ö–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π?")
        elif text == "‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è":
            await message.answer("‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:\n1. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ —Å–∏—Å—Ç–µ–º–µ.\n2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å.\n3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∞–º–∏.")
        elif text == "üõ† –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞":
            kb = InlineKeyboardMarkup(
                inline_keyboard=[
                    [InlineKeyboardButton(text="üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å", url="tel:+3800000000")],
                    [InlineKeyboardButton(text="üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram", url="https://t.me/username_support")]
                ]
            )
            await message.answer("üõ† –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏ —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:", reply_markup=kb)
        elif text == "üöÄ –û—Ç–∫—Ä—ã—Ç—å –ú–ö–°":
            kb = InlineKeyboardMarkup(
                inline_keyboard=[
                    [InlineKeyboardButton(text="üåê –ó–∞–ø—É—Å—Ç–∏—Ç—å WebApp", web_app=WebAppInfo(url="https://benworkmod228-coder.github.io/cosmic-shawarma/mcs.html"))]
                ]
            )
            await message.answer("–û—Ç–∫—Ä–æ–π—Ç–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ú–ö–°:", reply_markup=kb)
        else:
            await message.answer("‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é.", reply_markup=main_kb)

# ====== –ó–∞–ø—É—Å–∫ ======
async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
