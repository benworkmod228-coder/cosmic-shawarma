<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ñ–ö–• ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root { --primary:#1976d2; --primary-dark:#0d47a1; --bg:#f5f7fb; --card:#fff; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg)}
  .wrap{max-width:480px;margin:0 auto;padding:16px 16px 32px}
  .card{background:var(--card);border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.08);padding:20px}
  h1{font-size:22px;margin:0 0 6px;text-align:center;color:var(--primary)}
  p.sub{margin:0 0 16px;text-align:center;color:#667}
  .progress{height:6px;background:#e7ecf5;border-radius:999px;overflow:hidden;margin:6px 0 16px}
  .bar{height:100%;width:0;background:var(--primary);transition:width .25s ease}
  .field{margin:10px 0}
  label{display:block;margin:0 0 6px;color:#334}
  input,select{width:100%;padding:12px 14px;border:1px solid #dbe1ea;border-radius:10px;font-size:16px}
  .row{display:flex;gap:10px}
  button{width:100%;padding:12px 14px;border:none;border-radius:12px;font-weight:600;font-size:16px;cursor:pointer}
  .primary{background:var(--primary);color:#fff}
  .primary:disabled{opacity:.5;cursor:not-allowed}
  .ghost{background:#eef4ff;color:#274}
  .hidden{display:none}
  .help{margin-top:14px;font-size:14px;color:#667}
  .footer{margin-top:16px;text-align:center;color:#889}
  .ok{font-size:56px;margin:10px 0}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üè† –ñ–ö–• ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h1>
      <p class="sub">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ</p>

      <div class="progress"><div id="bar" class="bar"></div></div>

      <!-- –®–∞–≥ 1 -->
      <section id="s1">
        <div class="field">
          <label>–§–ò–û</label>
          <input id="fullname" placeholder="–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ" autocomplete="name">
        </div>
        <div class="row">
          <button class="ghost" id="faq1">–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</button>
          <button class="primary" id="n1">–î–∞–ª–µ–µ</button>
        </div>
      </section>

      <!-- –®–∞–≥ 2 -->
      <section id="s2" class="hidden">
        <div class="field">
          <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input id="phone" placeholder="+7 999 123-45-67" inputmode="tel">
        </div>
        <div class="row">
          <button class="ghost" id="b2">–ù–∞–∑–∞–¥</button>
          <button class="primary" id="n2">–î–∞–ª–µ–µ</button>
        </div>
      </section>

      <!-- –®–∞–≥ 3 -->
      <section id="s3" class="hidden">
        <div class="field">
          <label>–ê–¥—Ä–µ—Å</label>
          <input id="address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞" autocomplete="street-address">
        </div>
        <div class="row">
          <button class="ghost" id="b3">–ù–∞–∑–∞–¥</button>
          <button class="primary" id="n3">–î–∞–ª–µ–µ</button>
        </div>
      </section>

      <!-- –®–∞–≥ 4 -->
      <section id="s4" class="hidden">
        <div class="field">
          <label>–õ–∏—Ü–µ–≤–æ–π —Å—á—ë—Ç</label>
          <input id="account" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1234567890" inputmode="numeric">
        </div>
        <div class="row">
          <button class="ghost" id="b4">–ù–∞–∑–∞–¥</button>
          <button class="primary" id="n4">–î–∞–ª–µ–µ</button>
        </div>
      </section>

      <!-- –®–∞–≥ 5 -->
      <section id="s5" class="hidden">
        <div class="field">
          <label>–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞</label>
          <select id="doctype">
            <option value="–ü–∞—Å–ø–æ—Ä—Ç">üìÑ –ü–∞—Å–ø–æ—Ä—Ç</option>
            <option value="–ò–ù–ù">üßæ –ò–ù–ù</option>
            <option value="–°–ù–ò–õ–°">üü¢ –°–ù–ò–õ–°</option>
          </select>
        </div>
        <div class="row">
          <button class="ghost" id="b5">–ù–∞–∑–∞–¥</button>
          <button class="primary" id="n5">–î–∞–ª–µ–µ</button>
        </div>
      </section>
<!-- –®–∞–≥ 6 -->
      <section id="s6" class="hidden">
        <div class="field">
          <label>–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞</label>
          <input id="docnum" placeholder="4510 123456">
        </div>
        <div class="row">
          <button class="ghost" id="b6">–ù–∞–∑–∞–¥</button>
          <button class="primary" id="finish">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
        </div>
      </section>

      <!-- –ì–æ—Ç–æ–≤–æ -->
      <section id="done" class="hidden" style="text-align:center">
        <div class="ok">‚úÖ</div>
        <h2>–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã</h2>
        <p class="help">–ï—Å–ª–∏ –≤—ã –≤ Telegram, –æ–∫–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
        <div class="footer">–°–ø–∞—Å–∏–±–æ!</div>
      </section>
    </div>

    <div class="help">
      –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? <a href="https://t.me/" target="_blank" rel="noopener">–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞</a>
    </div>
  </div>

<script>
(function(){
  const tg = window.Telegram?.WebApp;
  if (tg) {
    tg.expand();
    tg.MainButton.hide(); // –≤—Å—ë —É–ø—Ä–∞–≤–ª—è–µ–º —Å–∞–º–∏
    tg.setHeaderColor("#ffffff");
    tg.setBackgroundColor("#f5f7fb");
  }

  const steps = ["s1","s2","s3","s4","s5","s6","done"];
  const data = JSON.parse(localStorage.getItem("jkh_form")||"{}");
  const els = {
    fullname: q("#fullname"),
    phone:    q("#phone"),
    address:  q("#address"),
    account:  q("#account"),
    doctype:  q("#doctype"),
    docnum:   q("#docnum"),
    bar:      q("#bar"),
  };

  // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞
  ["fullname","phone","address","account","doctype","docnum"].forEach(k=>{
    if (data[k]) els[k].value = data[k];
    els[k].addEventListener("input", saveDraft);
  });

  // –Ω–∞–≤–∏–≥–∞—Ü–∏—è
  on("#n1","click", ()=> validate1() && go(2));
  on("#n2","click", ()=> validate2() && go(3));
  on("#n3","click", ()=> validate3() && go(4));
  on("#n4","click", ()=> validate4() && go(5));
  on("#n5","click", ()=> go(6));
  on("#finish","click", finish);

  on("#b2","click", ()=> go(1));
  on("#b3","click", ()=> go(2));
  on("#b4","click", ()=> go(3));
  on("#b5","click", ()=> go(4));
  on("#b6","click", ()=> go(5));

  on("#faq1","click", ()=> alert("–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã:\n‚Ä¢ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ? –î–ª—è —Å–≤–µ—Ä–∫–∏ –ª–∏—Ü–µ–≤–æ–≥–æ —Å—á—ë—Ç–∞.\n‚Ä¢ –ú–æ–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∑–∂–µ? –î–∞, —á–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è."));

  // –º–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ-–º–∏–Ω–∏–º—É–º—É
  els.phone.addEventListener("blur", ()=>{
    let v = els.phone.value.replace(/\s|-/g,"");
    if (v && !v.startsWith("+7")) v = "+7"+v.replace(/^\+?8/,"");
    els.phone.value = v;
    saveDraft();
  });

  // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —à–∞–≥
  go(Number(localStorage.getItem("jkh_step")) || 1);

  function q(s){return document.querySelector(s)}
  function on(s,e,cb){q(s).addEventListener(e,cb)}
  function show(id){
    steps.forEach(s=>q("#"+s).classList.add("hidden"));
    q("#"+id).classList.remove("hidden");
  }
  function progress(step){
    const pct = Math.min(100, Math.round(((step-1)/6)*100));
    els.bar.style.width = pct + "%";
  }
  function go(step){
    show("s"+step);
    progress(step);
    localStorage.setItem("jkh_step", String(step));
  }
  function saveDraft(){
    const payload = {
      fullname: els.fullname.value.trim(),
      phone:    els.phone.value.trim(),
      address:  els.address.value.trim(),
      account:  els.account.value.trim(),
      doctype:  els.doctype.value,
      docnum:   els.docnum.value.trim(),
    };
    localStorage.setItem("jkh_form", JSON.stringify(payload));
  }

  // –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  function validate1(){
    if (els.fullname.value.trim().length < 5){ alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –§–ò–û"); return false; }
    return true;
  }
  function validate2(){
    const v = els.phone.value.trim();
    if (!/^\+7\d{10}$/.test(v)){ alert("–¢–µ–ª–µ—Ñ–æ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7XXXXXXXXXX"); return false; }
    return true;
  }
  function validate3(){
    if (els.address.value.trim().length < 5){ alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å"); return false; }
    return true;
  }
  function validate4(){
    if (!/^\d{5,}$/.test(els.account.value.trim())){ alert("–õ–∏—Ü–µ–≤–æ–π —Å—á—ë—Ç: –º–∏–Ω–∏–º—É–º 5 —Ü–∏—Ñ—Ä"); return false; }
    return true;
  }
// —Ñ–∏–Ω–∞–ª: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç–∞ (—Ç–∏—Ö–æ) –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º ¬´–≥–æ—Ç–æ–≤–æ¬ª
  function finish(){
    if (els.docnum.value.trim().length < 5){ alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞"); return; }

    const payload = {
      type: "jkh_form",
      fullname: els.fullname.value.trim(),
      phone: els.phone.value.trim(),
      address: els.address.value.trim(),
      account: els.account.value.trim(),
      doctype: els.doctype.value,
      docnum: els.docnum.value.trim(),
      ts: new Date().toISOString()
    };

    // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
    localStorage.setItem("jkh_form", JSON.stringify(payload));
    try {
      if (tg?.sendData) {
        tg.sendData(JSON.stringify(payload)); // –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –∫–∞–∫ web_app_data
      }
    } catch(e) { /* –∏–≥–Ω–æ—Ä */ }

    show("done");
    progress(7);
    // –æ—á–∏—Å—Ç–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ —á–µ—Ä–µ–∑ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ –∏ –∑–∞–∫—Ä—ã—Ç—å
    setTimeout(()=>{ localStorage.removeItem("jkh_form"); localStorage.removeItem("jkh_step"); }, 1500);
    if (tg?.close) setTimeout(()=>tg.close(), 1200);
  }
})();
</script>
</body>
</html>
